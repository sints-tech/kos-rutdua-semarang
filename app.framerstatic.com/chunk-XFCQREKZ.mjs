import{d as $,f as V}from"https://app.framerstatic.com/chunk-66XIMNKS.mjs";import{ia as E}from"https://app.framerstatic.com/chunk-IZV4HDYJ.mjs";import{a as u,b as k}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{a as l}from"https://app.framerstatic.com/chunk-LQILWJHN.mjs";import{j as p,k as L,l as M}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";function K(s){return typeof s=="string"}function y(s){return Number.isFinite(s)}function f(s){return s.key+s.extension}function d(s,e,t,r){let n=l(),i=new URL(`${n.userContent}/images/${s}`);return y(e)&&i.searchParams.set("scale-down-to",`${e}`),t==="lossless"&&i.searchParams.set("lossless","1"),r&&(i.searchParams.set("width",r.width.toString()),i.searchParams.set("height",r.height.toString())),i.toString()}function R(s,e,t){return d(f(s),e,t,s.properties?.image?{width:s.properties.image.width,height:s.properties.image.height}:void 0)}function g(s){return`${l().userContent}/assets/${s}`}function x(s){return g(f(s))}function G(s){let e=l(),t=new URL(s);if(t.origin!==e.userContent)return;let[,r,n,...i]=t.pathname.split("/");if(!(r!=="images"&&r!=="assets")&&!(n===void 0||n===""||i.length>0))return{filename:n,searchParams:t.searchParams}}var J={auto:!0,lossless:!0,small:!0,medium:!0,large:!0,full:!0};function C(s){return K(s)&&s in J}var S="framer/asset-reference,";function N(s){return s.startsWith(`data:${S}`)}var H="originalFilename",T="packageIdentifier",D="preferredSize",W="presetName",j="width",_="height";function m(s,e=null,t=null,r=null,n=null,i=null){u(s!=="","Can\u2019t create asset reference for empty identifier");let a=new URL(`data:${S}${s}`);return t&&a.searchParams.set(H,t),e&&a.searchParams.set(T,e),r&&a.searchParams.set(D,r),n&&a.searchParams.set(W,n),i&&(a.searchParams.set(j,i.width.toString()),a.searchParams.set(_,i.height.toString())),a.href}function Q({identifier:s,preferredSize:e,intrinsicSize:t,packageIdentifier:r,originalFilename:n,presetName:i}){return m(s,r,n,e,i,t)}function v(s){return m(s.identifier,s.packageIdentifier,s.originalFilename,s.preferredSize,s.presetName,s.intrinsicSize)}function A(s){if(N(s))try{let e=new URL(s),t=e.pathname.substring(S.length),r=e.searchParams.get(H),n=e.searchParams.get(T),i=e.searchParams.get(D),a=e.searchParams.get(W),o=e.searchParams.get(j),c=e.searchParams.get(_);return{identifier:t,originalFilename:r,packageIdentifier:n,preferredSize:C(i)?i:void 0,presetName:a,fileExtension:r&&X(r),intrinsicSize:o&&c?{width:parseInt(o),height:parseInt(c)}:void 0}}catch{return}}function X(s){return s.split(".").pop()??""}function z(s){return`${s.ownerType}::${s.key}`}var h,P=class{constructor(e){this.api=e;p(this,"assetUpdatesEmitter",new V);p(this,"currentAssets",new Map);p(this,"lastUpdatedAt");M(this,h,new E({delay:16,maxDelay:16*4,task:async()=>{let e=await this.api.getAssets({updatedFrom:this.lastUpdatedAt});this.lastUpdatedAt===void 0?this.updateAll(e.assets):this.updatePartial(e.assets),e.lastUpdatedAt&&(this.lastUpdatedAt=e.lastUpdatedAt)}}));p(this,"assetUpdatesStream",this.assetUpdatesEmitter.newStream);p(this,"uploadAsset",async e=>{if(!this.api.uploadAsset)throw Error("Asset service is read only");let t=await this.api.uploadAsset(e);return await this.refresh(),t});p(this,"duplicateAssets",async(e,t)=>{if(!this.api.duplicateAssets)throw Error("Asset service is read only");let r=await this.api.duplicateAssets(e,t);return this.addAssets(r),r});this.assetUpdatesEmitter.emit({})}async refresh(){L(this,h).debounce()}async refreshFully(){this.lastUpdatedAt=void 0,await this.refresh()}updateAll(e){this.currentAssets=new Map(e.map(t=>[z(t),t])),this.assetUpdatesEmitter.emit({assets:Array.from(this.currentAssets.values())})}updatePartial(e){for(let t of e)this.currentAssets.set(z(t),t);this.assetUpdatesEmitter.emit({assets:Array.from(this.currentAssets.values())})}addAssets(e){this.updatePartial(e)}deleteProjectAssets(e){let t=!1;for(let r of e)t||=this.currentAssets.delete(z({ownerType:"project",key:r}));t&&this.assetUpdatesEmitter.emit({assets:Array.from(this.currentAssets.values())})}async duplicateWorkspaceAssets(e,t){if(!this.api.duplicateWorkspaceAssets)throw Error("Asset service is read only");let r=await this.api.duplicateWorkspaceAssets(e,t);this.addAssets(r)}getAssetByFilename(e){for(let t of this.currentAssets.values())if(f(t)===e)return t}};h=new WeakMap;var Y=/^(.*?)(?:([^/])\.([^/.]+))?$/;function U(s){let e=s.match(Y);return e?[e[1]+(e[2]??""),e[3]??""]:[s,""]}var w=class{constructor(){p(this,"assets",new Map);p(this,"_hash",0)}get hash(){return this._hash}patch(e){for(let t of e)this.assets.set(t.key,t);this._hash++}set(e){this.assets.clear(),this.patch(e)}items(){return Array.from(this.assets.values())}assetForKey(e){let[t]=U(e),r=this.assets.get(t);if(r)return r;for(let n of this.assets.values())if(n.name===e)return n}};function B(s,e){switch(s){case"small":return 512;case"medium":return 1024;case"large":return 2048;case"full":return;case"lossless":case"auto":case void 0:return y(e)?e:void 0;default:k(s)}}var Z=[512,1024,2048,4096];function F(s,e){if(s===void 0||e===void 0)return;let t=s,r=e,n=0;e>s&&(t=e,r=s,n=1);let i=t/r,a=[];for(let o of Z){if(t<=o)return a;a.push({maxSideSize:o,width:n===0?o:Math.trunc(o/i)})}return a}function b(s,e,t,r){let n,i=s?.properties?.image,a=B(e,t);a!==void 0&&i&&(r??=F(i.width,i.height),r&&(n=r.find(({maxSideSize:c})=>c>=a)));let o=n?.maxSideSize;return{maxSideSize:o,width:n?.width,url:R(s,o,e)}}var O=/^node_modules\/(@[^/]+\/[^/]+|[^/]+)\/(.*)/;function q(s,e,t){return`${s}/packages/${e}/latest/${t}`}function ee(s,e){let t=e.replace(/%40/gu,"@"),r=O.exec(t);if(r?.[1]&&r?.[2]){let n=r[1],i=r[2];u(n,"did not match packageName"),u(i,"did not match filePath");let a=q(s,n,i);if(a)return a}return t}function se(s,e){return(r,n)=>{if(!r)return;let i=!1,a=A(r);if(a){let{identifier:c,packageIdentifier:I}=a;if(I)return q(s,I,c);i=!0,r=c}else if(n?.isFramerResourceURL)return ee(s,r);let o=e.assetForKey(r);if(o){if(o.properties?.kind==="image"){let c=n?.preferredSize??a?.preferredSize;return b(o,c,n?.pixelSize).url}return x(o)}if(i)return a?.intrinsicSize?d(r,void 0,void 0,a.intrinsicSize):g(r)}}function te(s,e){Promise.resolve(s).then(t=>t.assetUpdatesStream({replay:"latest"}).read(e)).catch($)}function re(s,e){let t=s?A(s):void 0;return t?v({...t,preferredSize:e}):m(s,null,null,e)}export{K as a,y as b,f as c,d,R as e,g as f,x as g,G as h,P as i,U as j,w as k,N as l,m,Q as n,v as o,A as p,F as q,b as r,se as s,te as t,re as u};
//# sourceMappingURL=https://app.framerstatic.com/chunk-XFCQREKZ.mjs.map
